/**
 * @file
 * Global utilities.
 *
 */
(function ($, Drupal) {

  'use strict';

  Drupal.behaviors.worldfish = {
    attach: function (context, settings) {

        // Page loading animation

        $("#preloader").animate({
            'opacity': '0'
        }, 600, function(){
            setTimeout(function(){
                $("#preloader").css("visibility", "hidden").fadeOut();
            }, 300);
        });
        

        // slick overrides for publications card navigation style
        $(".slick-publications").on("init", function(event, slick) {
    			addCustomSlickAttributes();
    		})
    		$(".slick-publications").on("afterChange", function(event, slick, current_slide_index, next_slide_index) {
    		    addCustomSlickAttributes();
    		})

    		function addCustomSlickAttributes() {
    		    // Remove old attributes
    		    $("div[class*='keepTrackActive']").removeClass (function (index, css) {
    			   return (css.match (/(^|\s)keepTrackActive\S+/g) || []).join(' ');
    			});
    		    // Iterate through each active slide and add our custom attribute
    		    $(".slick-active").each(function(index, el) {
    		        $(el).addClass("keepTrackActive" + index);
    		    })

    		}
        //END slick overrides for publications card navigation style

	    //auto launch modal
	    
	    $(window).on('load',function(){
           $('.automodal').modal('show')
      	});
      	        
		 
    }
  };

    $(document).ready(function(){
	    
	    $('[data-toggle="tooltip"]').tooltip()
  
        // megamenu toggle behaviour
        $(".navbar-toggle.collapsed").on("click", function () {
                
            var $this = $(this);
         
            if ($this.hasClass('collapsed')) {
                $this.removeClass('collapsed');
                $this.addClass("show")
                $(".navbar-we-mega-menu.mobile-collapse").addClass("visible");
            } else {
                $(".we-mega-menu-ul li.we-mega-menu-li").removeClass("open");
                $this.addClass('collapsed');
                $this.removeClass('show');
                $(".navbar-we-mega-menu.mobile-collapse").removeClass("visible");
            }

        })

        $(".d-submenu-toggler").on("click", function () {
            $(this).parent().toggleClass("open");
        })
        // megamenu toggle behaviour                
        
        // 
        // SEARCH BOX
        // 
        $("#block-worldfish-search span.close").click(function(){
          $("header .searcharea .search-form-overlay").slideUp();
        });

        $("#block-worldfish-search span.open").click(function(){
          $("header .searcharea .search-form-overlay").slideDown();
        }); 


        // 
        // SEARCH BOX
        // 
        // 
        // 
        // CHOSEN SUPPORT MOBILE
            // Chosen touch support.
            // if ($('.chosen-container').length > 0) {
            //   $('.chosen-container').on('touchstart', function(e){
            //     e.stopPropagation(); e.preventDefault();
            //     // Trigger the mousedown event.
            //     $(this).trigger('mousedown');
            //   });
            // }
        // CHOSEN SUPPORT MOBILE
        // 
        
		//animating footer wave
        var myWave = $('#wavefooter').wavify({
          height: 60,
          bones: 3,
          amplitude: 40,
          color: 'rgba(28, 72, 107, 1)',
          speed: .15,
          container: '#waveanimation'
        });
		
		if($('#waveslider').length){
	        var myWaveSlider = $('#waveslider').wavify({
	          height: 60,
	          bones: 3,
	          amplitude: 40,
	          color: 'rgba(255, 255, 255, 1)',
	          speed: .15,
	          container: '.homepage-main-banner'
	        });        
			
		}
        //end animating footer wave
        
        //
        // scroll behaviour for country offices
        //
        
        var ele   = $('.country-offices');
	    var speed = 25, scroll = 5, scrolling;
	    
	    $('.wherewework .view-content h3.title i.fa-arrow-up').mouseenter(function() {
	        // Scroll the element up
	        scrolling = window.setInterval(function() {
	            ele.scrollTop( ele.scrollTop() - scroll );
	        }, speed);
	    });
	    
	    $('.wherewework .view-content h3.title i.fa-arrow-down').mouseenter(function() {
	        // Scroll the element down
	        scrolling = window.setInterval(function() {
	            ele.scrollTop( ele.scrollTop() + scroll );
	        }, speed);
	    });
	    
	    $('.wherewework .view-content h3.title i').bind({
	        click: function(e) {
	            // Prevent the default click action
	            e.preventDefault();
	        },
	        mouseleave: function() {
	            if (scrolling) {
	                window.clearInterval(scrolling);
	                scrolling = false;
	            }
	        }
	    });
	     // scroll behaviour for country offices

	    // running numbers
		  $(".running-nr").countimator({
			  duration: 3000
		  });
	    // running numbers	          	
	    

		
		// #block-sharethispage togle
		$('.sharethis-toggle').click(function() {
			event.preventDefault();
			$('.contacttoggle').hide();
	        $('.sharethistoggle').slideToggle();
	    });
		$('.contact-toggle').click(function() {
			event.preventDefault();
			$('.sharethistoggle').hide();
	        $('.contacttoggle').slideToggle();
	    });
		//end #block-sharethispage togle
      	
      	
      	
      	// featured video sticky 
      	
			var $window = $(window);
			var $videoWrap = $('.video-wrap');
			var $video = $('.videofloat');
			var videoHeight = $video.outerHeight();
			var $close = $('.closevideo');
			
			if (typeof videoWrap !== 'undefined') {	
				$window.on('scroll',  function() {
				  var windowScrollTop = $window.scrollTop();
				  var videoBottom = videoHeight + $videoWrap.offset().top;	  
				  
				  if (windowScrollTop > videoBottom) {
				    if ( !$video.hasClass('closed') ) {
				      $video.addClass('stuck');
				      if ( !$video.hasClass('button-visible') ) {
				        $video.append('<span class="closevideo">X<span/>').addClass('button-visible');
				      }
				      $close = $video.find('.closevideo');
				      $close.on('click', function() {
				        $video.removeClass('stuck');
				        $video.addClass('closed');
				        $('.closevideo').remove();
				      });
				    }
				  } else {
				    $videoWrap.height('auto');
				    $video.removeClass('stuck');
				    $video.removeClass('closed');
				    $video.removeClass('button-visible');
				  }
				});
			}


		// end featured video sticky 
		
		// add responsive class to iframes on body
		$('.node--type-news .field--name-body iframe').parent().addClass('video-embed-field-responsive-video');
		$('.node--type-events .field--name-body iframe').parent().addClass('video-embed-field-responsive-video');

		// end add responsive class to iframes on body
		
    }); // end document ready

})(jQuery, Drupal);